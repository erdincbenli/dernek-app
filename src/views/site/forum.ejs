<%- include("../layouts/main", { body: `
  <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-3">
    <div>
      <h4 class="mb-1"><i class="bi bi-chat-left-text me-1"></i>Forum</h4>
      <div class="text-muted">Soru sor, paylas, tartis</div>
    </div>
    <a class="btn btn-ghost btn-sm" href="/"><i class="bi bi-house me-1"></i>Anasayfa</a>
  </div>

  ${topics ? `
    <div class="card app-card shadow-sm mb-4">
      <div class="card-body p-0">
        <div class="list-group list-group-flush">
          ${topics.map(t => `
            <a class="list-group-item list-group-item-action py-3" href="/forum/${t.id}">
              <div class="fw-semibold">${t.title}</div>
              <div class="text-muted small">${t.created_at}</div>
            </a>
          `).join("") || `<div class="p-3 text-muted">Henuz konu yok.</div>`}
        </div>
      </div>
    </div>
  ` : ""}

  ${topic ? `
    <div class="card app-card shadow-sm mb-3">
      <div class="card-body">
        <div class="fw-semibold fs-5">${topic.title}</div>
        <div class="text-muted small mb-2">${topic.created_at}</div>
        <div class="app-content-text">${topic.body}</div>
      </div>
    </div>

    <div class="card app-card shadow-sm mb-3">
      <div class="card-body">
        <div class="fw-semibold mb-2">Yorumlar</div>
        ${(posts||[]).map(p => `
          <div class="border rounded-3 p-3 mb-2 bg-white">
            <div class="text-muted small mb-1">${p.created_at}</div>
            <div class="app-content-text">${p.body}</div>
          </div>
        `).join("") || "<div class='text-muted'>Henuz yorum yok.</div>"}
      </div>
    </div>

    ${user ? `
    <div class="card app-card shadow-sm">
      <div class="card-body">
        <form method="post" action="/forum/${topic.id}/post">
          <input type="hidden" name="_csrf" value="${csrfToken}"/>
          <label class="form-label fw-semibold">Yorum yaz</label>
          <textarea class="form-control mb-2" name="body" rows="3" placeholder="Yorum..." required></textarea>
          <button class="btn btn-primary btn-sm"><i class="bi bi-send me-1"></i>Gonder</button>
        </form>
      </div>
    </div>
    ` : `<div class="alert alert-info shadow-sm">Yorum icin giris yapmalisin.</div>`}
  ` : ""}

  ${user ? `
  <div class="card app-card shadow-sm mt-4">
    <div class="card-body">
      <h6 class="fw-semibold mb-2">Yeni Konu</h6>
      <form method="post" action="/forum/create">
        <input type="hidden" name="_csrf" value="${csrfToken}"/>
        <input class="form-control mb-2" name="title" placeholder="Baslik" required/>
        <textarea class="form-control mb-2" name="body" rows="3" placeholder="Icerik" required></textarea>
        <button class="btn btn-outline-primary btn-sm"><i class="bi bi-plus-lg me-1"></i>Konuyu ac</button>
      </form>
    </div>
  </div>
  ` : ""}
` }) %>
